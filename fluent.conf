<source>
  type tail
  path /fluentd/containers/*/*-json.log
  pos_file /fluentd/log/fluentd-docker.pos
  time_format %Y-%m-%dT%H:%M:%S
  tag docker.*
  format json
</source>

<filter docker.fluentd.containers.*.*.log>
  type docker_metadata
</filter>

<filter docker.fluentd.containers.*.*.log>
  @type ec2_env
</filter>

# Get hostname of the container
<filter docker.fluentd.containers.*.*.log>
  @type record_modifier
  <record>
    host "#{Socket.gethostname}"
    @type "fluentd"
  </record>
</filter>

#<match docker.fluentd.containers.*.*.log>
#  @type stdout
#</match>

#Ship to redis and RPUSH onto a List item
<match docker.fluentd.containers.*.*.log>
  type redis_store
  flush_interval 1s
  host "#{ENV['REDIS_HOST']}"
  port "#{ENV['REDIS_PORT'] || 6379}"
  store_type list
  key "#{ENV['REDIS_KEY']}"
  order asc
</match>
